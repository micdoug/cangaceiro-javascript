{"version":3,"sources":["../../app-src/controllers/NegociacaoController.js"],"names":["Negociacao","NegociacaoService","Negociacoes","DateConverter","MensagemView","Mensagem","NegociacoesView","DataInvalidaError","DaoFactory","Bind","debounce","controller","bindEvent","NegociacaoController","constructor","_inputData","_inputQuantidade","_inputValor","Object","assign","_negociacoes","_mensagem","_service","_dao","init","dao","getDao","negociacoes","listaTodos","sort","left","right","data","getTime","negociacao","adiciona","getNegociacaoDao","event","preventDefault","_criarNegociacao","texto","_limpaFormulario","error","console","log","stack","message","paraData","value","parseInt","parseFloat","focus","apaga","apagaTodos","esvazia","importarNegociacoes","obterNegociacoesDoPeriodo","filter","paraArray","some","item","equals"],"mappings":"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","file":"NegociacaoController.js","sourcesContent":["import { Negociacao, NegociacaoService, Negociacoes } from \"../domain/index.js\";\nimport { DateConverter, MensagemView, Mensagem, NegociacoesView, DataInvalidaError } from \"../ui/index.js\";\nimport { DaoFactory, Bind, debounce, controller, bindEvent } from \"../util/index.js\";\n\n@controller(\"#data\", \"#quantidade\", \"#valor\")\nexport class NegociacaoController {\n\n  constructor(_inputData, _inputQuantidade, _inputValor) {\n    Object.assign(this, { _inputData, _inputQuantidade, _inputValor });\n    this._negociacoes = new Bind(new Negociacoes(), new NegociacoesView(\"#negociacoes\"),\n      [\"adiciona\", \"esvazia\"]);\n    this._mensagem = new Bind(new Mensagem(), new MensagemView(\"#mensagemView\"),\n      [\"texto\"]);\n    this._service = new NegociacaoService();\n    this._dao = null;\n    this.init();\n  }\n\n  async init() {\n    const dao = await this.getDao();\n    const negociacoes = await dao.listaTodos();\n    negociacoes.sort((left, right) => right.data.getTime() - left.data.getTime());\n    for (let negociacao of negociacoes) {\n      this._negociacoes.adiciona(negociacao);\n    }\n  }\n\n  async getDao() {\n    if (this._dao) return this._dao;\n    this._dao = await DaoFactory.getNegociacaoDao();\n    return this._dao;\n  }\n\n  @bindEvent('submit', '.form')\n  async adiciona(event) {\n    try {\n      event.preventDefault();\n      const negociacao = this._criarNegociacao();\n      const dao = await this.getDao();\n      await dao.adiciona(negociacao);\n      this._negociacoes.adiciona(negociacao);\n      this._mensagem.texto = \"Negociação adicionada com sucesso!\";\n      this._limpaFormulario();\n    } catch (error) {\n      console.log(error);\n      console.log(error.stack);\n      if (error instanceof DataInvalidaError) {\n        this._mensagem.texto = error.message;\n      } else {\n        this._mensagem.texto = \"Um erro inesperado aconteceu. Entre em contato com o suporte.\";\n      }\n    }\n  }\n\n  // carrega os dados do formulário e cria um novo objeto Negociacao\n  _criarNegociacao() {\n    return new Negociacao(\n      DateConverter.paraData(this._inputData.value),\n      parseInt(this._inputQuantidade.value),\n      parseFloat(this._inputValor.value),\n    );\n  }\n\n  _limpaFormulario() {\n    this._inputData.value = \"\";\n    this._inputQuantidade.value = 0;\n    this._inputValor.value = 0.0;\n    this._inputData.focus();\n  }\n\n  @bindEvent('click', '#botao-apaga')\n  async apaga() {\n    try {\n      const dao = await this.getDao();\n      await dao.apagaTodos();\n      this._negociacoes.esvazia();\n      this._mensagem.texto = \"Negociações apagadas com sucesso!\";\n    } catch (error) {\n      this._mensagem.texto = \"Não foi possível apagar negociações.\";\n    }\n  }\n\n  @bindEvent('click', '#botao-importa')\n  @debounce(1000)\n  async importarNegociacoes() {\n    try {\n      const negociacoes = (await this._service.obterNegociacoesDoPeriodo())\n        .filter(negociacao => !this._negociacoes.paraArray()\n          .some(item => item.equals(negociacao)));\n      const dao = await this.getDao();\n      for (let negociacao of negociacoes) {\n        await dao.adiciona(negociacao);\n        this._negociacoes.adiciona(negociacao);\n      }\n      this._mensagem.texto = \"Negociações importadas com sucesso!\";\n    } catch (error) {\n      this._mensagem.texto = error.message;\n    }\n  }\n\n}"]}